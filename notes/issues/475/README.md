# Issue #475: [Impl] Setup Coverage - Core Implementation

## Objective

Implement coverage tool setup based on the design from Issue #473 and validated by tests in Issue #474, installing and configuring coverage collection for the shared library.

## Deliverables

- Coverage tool installation scripts or configuration
- Test framework integration for coverage collection
- CI pipeline coverage configuration
- Coverage data storage implementation
- Configuration files and documentation

## Success Criteria

- [ ] Coverage tool is installed and functional
- [ ] Coverage collection works during test execution
- [ ] Integration with test framework is seamless
- [ ] CI pipeline collects coverage automatically
- [ ] Coverage data is stored in standard format
- [ ] All tests from Issue #474 pass

## References

### Parent Issues

- [Issue #473: [Plan] Setup Coverage](../473/README.md) - Design and architecture
- [Issue #474: [Test] Setup Coverage](../474/README.md) - Test specifications

### Related Issues

- [Issue #476: [Package] Setup Coverage](../476/README.md) - Packaging
- [Issue #477: [Cleanup] Setup Coverage](../477/README.md) - Cleanup

### Comprehensive Documentation

- [5-Phase Workflow](/home/user/ml-odyssey/notes/review/README.md)
- [Agent Hierarchy](/home/user/ml-odyssey/agents/hierarchy.md)
- [Testing Infrastructure Summary](/home/user/ml-odyssey/notes/issues/TESTING-INFRASTRUCTURE-SUMMARY.md)

## Implementation Notes

### Critical Decision Required

**Mojo Coverage Tool Selection**: Based on Issue #473's research, implement the selected coverage approach:

**Option 1: Python Coverage.py** (Recommended for immediate use)
- Scope: Python automation scripts only (not Mojo ML code)
- Install: Already in pyproject.toml dependencies
- Config: Already configured in pyproject.toml
- Limitation: **Does not cover Mojo code**
- Use case: Cover Python CI/CD scripts, tooling

**Option 2: Custom Mojo Instrumentation** (Future solution)
- Scope: Mojo test files and source code
- Approach: Insert coverage tracking in compiled code
- Implementation: Requires compiler hooks or AST manipulation
- Limitation: **Not available yet** - needs Mojo team support

**Option 3: LLVM Coverage** (Advanced option)
- Scope: LLVM IR generated by Mojo compiler
- Approach: Use LLVM's coverage infrastructure
- Implementation: Requires LLVM flags in Mojo compilation
- Limitation: **Experimental** - needs investigation

### Minimal Implementation Strategy

**Start Small**:

1. **Validate Python coverage works**:
   ```bash
   # Test coverage for Python scripts
   pytest --cov=scripts tests/
   ```

2. **Document Mojo coverage gap**:
   - Create ADR for coverage tool selection
   - Document limitations and workarounds
   - Track as technical debt for future resolution

3. **Set up data storage**:
   - Use existing Python coverage data format (.coverage file)
   - Store in `.coverage/` directory
   - Configure .gitignore appropriately

4. **Configure CI**:
   - Add coverage collection step to GitHub Actions
   - Store coverage artifacts
   - Prepare for reporting phase (Issue #478-482)

### Files to Modify

**Existing Files**:
- `pyproject.toml` - Already has coverage configuration (validate settings)
- `.github/workflows/*.yml` - Add coverage collection steps
- `.gitignore` - Add coverage data directories

**New Files** (minimal):
- `docs/coverage-strategy.md` - Document current approach and limitations
- `scripts/collect_coverage.py` - Helper script for CI coverage collection
- `.coveragerc` or `pyproject.toml` updates - Fine-tune coverage settings

### Configuration Example

```toml
[tool.coverage.run]
source = ["src", "scripts"]
omit = [
    "tests/*",
    "**/__pycache__/*",
    "**/vendor/*",
    "**/.venv/*"
]
parallel = true
branch = true

[tool.coverage.report]
precision = 2
show_missing = true
skip_covered = false
fail_under = 80
```

### CI Integration

```yaml
# .github/workflows/test.yml
- name: Collect Coverage
  run: |
    pytest --cov=scripts --cov-report=xml --cov-report=html

- name: Upload Coverage Artifacts
  uses: actions/upload-artifact@v3
  with:
    name: coverage-reports
    path: |
      htmlcov/
      coverage.xml
```

### Open Questions

- [ ] What Mojo coverage tools are available in v0.25.7?
- [ ] Can we instrument Mojo code at compile time?
- [ ] Should we integrate with external coverage services (Codecov)?
- [ ] What performance overhead is acceptable?

### Status

Created: 2025-11-19
Status: Pending implementation
Dependencies: Issue #473 (Plan) and #474 (Test) must be completed first
