# Day Twenty-Four: Checkpoints and Data Loading

**Project:** ML Odyssey Manual
**Date:** December 1, 2025
**Branch:** `main`
**Tags:** #serialization #checkpoints #data-loading #emnist #cifar

---

> **Note:** This blog post was AI-generated based on git commit history.
> Content reflects actual work done but was not written in real-time.

---

## TL;DR

Built comprehensive checkpoint and data loading infrastructure. Implemented tensor serialization utilities, EMNIST and CIFAR-10 dataset wrappers, and checkpoint support with NamedTensor. Migrated examples to use shared data loaders for consistency. The data pipeline is now production-ready for training experiments.

**Key insight:** Good checkpoint infrastructure pays dividends forever—training crashes happen, and being able to resume from the last saved state saves hours of GPU time.

---

## Checkpoint Infrastructure

### NamedTensor Support

Built checkpoint support with named tensor storage:

```mojo
struct Checkpoint:
    var tensors: Dict[String, ExTensor]
    var metadata: Dict[String, String]

    fn save(self, path: String) raises:
        # Serialize all named tensors
        for name, tensor in self.tensors:
            serialize_tensor(tensor, path / name)

    @staticmethod
    fn load(path: String) raises -> Checkpoint:
        # Deserialize checkpoint
        ...
```

### Features

- Named tensor storage with metadata
- Versioned checkpoint format
- Atomic writes (write to temp, then rename)
- Automatic dtype preservation

---

## Dataset Wrappers

### EMNIST Wrapper

```mojo
struct EMNIST(Dataset):
    var images: ExTensor
    var labels: ExTensor
    var split: String  # "train", "test"

    fn __getitem__(self, idx: Int) -> Tuple[ExTensor, Int]:
        return (self.images[idx], self.labels[idx].item())

    fn __len__(self) -> Int:
        return len(self.labels)
```

### CIFAR-10 Wrapper

Similar pattern for CIFAR-10 with RGB image handling and 10-class labels.

---

## Example Migration

Migrated all examples to use shared data loaders:

- EMNIST examples → shared EMNIST loader
- CIFAR-10 examples → shared CIFAR loader
- Benchmarking examples → shared framework

This reduces code duplication and ensures consistent data handling.

---

## Serialization Fixes

Fixed several serialization issues:

1. **Ownership transfer** - Return checkpoint without copy
2. **File I/O** - Proper path handling across platforms
3. **Dtype preservation** - Maintain dtype through round-trip

---

## What's Next

### Immediate Priorities

1. **Resume training** - Test checkpoint restore during training
2. **Distributed checkpoints** - Support for model parallelism
3. **Compression** - Add optional checkpoint compression

---

## Reflections

1. **Atomic writes prevent corruption** - Always write-then-rename
2. **Named tensors simplify debugging** - Know what each tensor is
3. **Shared loaders reduce bugs** - One implementation, tested once

---

**Status:** Checkpoint infrastructure complete, dataset wrappers working, examples migrated

**Next:** Resume training tests, distributed support, compression

### Stats

- **Commits:** 22
- **Dataset wrappers:** EMNIST, CIFAR-10
- **Checkpoint features:** Named tensors, metadata, atomic writes
- **Examples migrated:** All EMNIST and CIFAR examples

---

*This post was reconstructed from git history by AI on December 30, 2025.*
