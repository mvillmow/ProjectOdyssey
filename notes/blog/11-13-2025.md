# Day Seven: Agents Stay Alive On Optimized Budgets

**Project:** ML Odyssey Manual
**Date:** November 13, 2025
**Branch:** `main`
**Tags:** #agentic-workflows #token-optimization #cost-analysis #model-tiering #discovery

---

## TL;DR

Agents are running efficiently after yesterday's model-tiering optimizations. Used `ccusage` tool to
analyze token consumption across sessions and discovered a major shift: Haiku usage increased 6.5x
relative to Opus (from 2x to 6.5x), demonstrating the model-tier strategy is working. The agentic
workflow is alive and showing measurable improvements in model utilization. Also filed a bug against
Mojo's formatter for a corner case handling issue, temporarily disabled the `mojo format` pre-commit
hook.

**Key data:** Haiku-to-Opus ratio improved from 2x to 6.5x, ~430M tokens consumed in 3 days (hitting
weekly limit).

---

## Why Documentation Matters For Iteration

You might be asking why I've been spending so much time on documentation instead of racing into
implementation.

The reason is simple: it lets me work out the kinks in the agents without really worrying about
"correctness" of the program. It's quite easy to review documentation relative to code, so I can
iterate faster. And documentation at this stage doesn't have to be the highest quality—as long as the
general idea is correct, I can measure what's working.

In reality, the code is the ground truth. Once the code is added, then I can clean up the documentation
to follow the code.

The agents got their API budget back after a few days of downtime. And they're blowing through the
weekly budget very quickly. One day of running suggests I'm already about 30% through the budget. The
data coming out of `ccusage` is actually pretty interesting, and it shows whether my agentic flow
improvements are working.

Time to analyze.

---

## CC Usage: Measuring Agent Efficiency

What is `ccusage`? It's a tool to estimate Claude Code usage and costs.

### Current Session Information

Here's data from the current session using `ccusage session -b`:

```text
┌────────────┬─────────────────────────┬──────────────┬──────────────┬──────────────┬──────────────┬──────────────┬──────────────┬──────────┐
│ Session    │ Models                  │        Input │       Output │ Cache Create │   Cache Read │ Total Tokens │   Cost (USD) │ Last     │
│            │                         │              │              │              │              │              │              │ Activity │
├────────────┼─────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────┤
│ ml-odyssey │ - haiku-4-5             │      549,194 │    3,470,255 │   30,092,427 │  339,226,799 │  373,338,675 │      $302.88 │ 2025-11… │
│            │ - opus-4-1              │              │              │              │              │              │              │          │
│            │ - sonnet-4-5            │              │              │              │              │              │              │          │
├────────────┼─────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────┤
│   └─       │                         │      491,060 │    2,873,480 │   26,928,298 │  293,109,773 │  323,402,611 │      $233.49 │          │
│ sonnet-4-5 │                         │              │              │              │              │              │              │          │
├────────────┼─────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────┤
│   └─       │                         │        1,229 │      249,289 │    1,108,022 │   14,943,890 │   16,302,430 │       $61.91 │          │
│ opus-4-1   │                         │              │              │              │              │              │              │          │
├────────────┼─────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────┤
│   └─       │                         │       56,905 │      347,486 │    2,056,107 │   31,173,136 │   33,633,634 │        $7.48 │          │
│ haiku-4-5  │                         │              │              │              │              │              │              │          │
├────────────┼─────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────┤
│ odyssey-m… │ - haiku-4-5             │      190,624 │    1,299,284 │   12,877,819 │  148,069,532 │  162,437,259 │      $105.71 │ 2025-11… │
│            │ - sonnet-4-5            │              │              │              │              │              │              │          │
├────────────┼─────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────┤
│   └─       │                         │      184,689 │    1,184,200 │   11,518,912 │  135,565,910 │  148,453,711 │      $102.18 │          │
│ sonnet-4-5 │                         │              │              │              │              │              │              │          │
├────────────┼─────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────┤
│   └─       │                         │        5,935 │      115,084 │    1,358,907 │   12,503,622 │   13,983,548 │        $3.53 │          │
│ haiku-4-5  │                         │              │              │              │              │              │              │          │
├────────────┼─────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────┤
│ test-agen… │ - haiku-4-5             │        1,264 │       77,116 │    1,568,911 │   12,293,618 │   13,940,909 │       $10.62 │ 2025-11… │
│            │ - sonnet-4-5            │              │              │              │              │              │              │          │
├────────────┼─────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────┤
│   └─       │                         │        1,252 │       76,213 │    1,528,156 │   12,285,255 │   13,890,876 │       $10.56 │          │
│ sonnet-4-5 │                         │              │              │              │              │              │              │          │
├────────────┼─────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────┤
│   └─       │                         │           12 │          903 │       40,755 │        8,363 │       50,033 │        $0.06 │          │
│ haiku-4-5  │                         │              │              │              │              │              │              │          │
├────────────┼─────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────┤
│ Total      │                         │      741,082 │    4,846,655 │   44,539,157 │  499,589,949 │  549,716,843 │      $419.21 │          │
└────────────┴─────────────────────────┴──────────────┴──────────────┴──────────────┴──────────────┴──────────────┴──────────────┴──────────┘
```

### The Problem: Sonnet Dominance

My major driver is still Sonnet, not Haiku. That suggests I need to further refine the agents to use
Haiku more. But if I compare last week (Nov 7th-12th) versus this week (Nov 13th), I can definitely see
an increase in Haiku relative to everything else. So maybe the agentic workflows are actually working.

Let me look at the data week-by-week.

### Weekly Breakdown: Nov 7th-12th Results

```text
┌────────────────┬──────────────────────────────────┬──────────────┬──────────────┬──────────────┬──────────────┬──────────────┬──────────────┐
│ Month          │ Models                           │        Input │       Output │ Cache Create │   Cache Read │ Total Tokens │   Cost (USD) │
├────────────────┼──────────────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┤
│ 2025-11        │ - haiku-4-5                      │      558,756 │    3,580,214 │   34,358,117 │  392,097,459 │  430,594,546 │      $327.84 │
│                │ - opus-4-1                       │              │              │              │              │              │              │
│                │ - sonnet-4-5                     │              │              │              │              │              │              │
├────────────────┼──────────────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┤
│   └─ sonnet-4… │                                  │      540,248 │    3,204,443 │   31,821,825 │  361,029,851 │  396,596,367 │      $277.33 │
├────────────────┼──────────────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┤
│   └─ opus-4-1  │                                  │          783 │      204,983 │      697,442 │   11,263,478 │   12,166,686 │       $45.36 │
├────────────────┼──────────────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┤
│   └─ haiku-4-5 │                                  │       17,725 │      170,788 │    1,838,850 │   19,804,130 │   21,831,493 │        $5.15 │
├────────────────┼──────────────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┤
│ Total          │                                  │      558,756 │    3,580,214 │   34,358,117 │  392,097,459 │  430,594,546 │      $327.84 │
└────────────────┴──────────────────────────────────┴──────────────┴──────────────┴──────────────┴──────────────┴──────────────┴──────────────┘
```

**Ratio analysis**: Sonnet is 40x Opus and Haiku is 2x Opus. Very heavy on Sonnet usage. I hit my
limit of around 430M tokens in a little under 3 days.

### Same Period: Nov 13th Results

```text
┌────────────────┬──────────────────────────────────┬──────────────┬──────────────┬──────────────┬──────────────┬──────────────┬──────────────┐
│ Month          │ Models                           │        Input │       Output │ Cache Create │   Cache Read │ Total Tokens │   Cost (USD) │
├────────────────┼──────────────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┤
│ 2025-11        │ - haiku-4-5                      │      182,582 │    1,297,815 │   10,397,113 │  112,379,661 │  124,257,171 │       $94.12 │
│                │ - opus-4-1                       │              │              │              │              │              │              │
│                │ - sonnet-4-5                     │              │              │              │              │              │              │
├────────────────┼──────────────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┤
│   └─ sonnet-4… │                                  │      137,009 │      960,824 │    8,369,614 │   84,818,258 │   94,285,705 │       $71.65 │
├────────────────┼──────────────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┤
│   └─ opus-4-1  │                                  │          446 │       44,306 │      410,580 │    3,680,412 │    4,135,744 │       $16.55 │
├────────────────┼──────────────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┤
│   └─ haiku-4-5 │                                  │       45,127 │      292,685 │    1,616,919 │   23,880,991 │   25,835,722 │        $5.92 │
├────────────────┼──────────────────────────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┼──────────────┤
│ Total          │                                  │      182,582 │    1,297,815 │   10,397,113 │  112,379,661 │  124,257,171 │       $94.12 │
└────────────────┴──────────────────────────────────┴──────────────┴──────────────┴──────────────┴──────────────┴──────────────┴──────────────┘
```

**Ratio analysis**: Sonnet to Opus is 46x and Haiku to Opus is 6.5x. That's a very large increase in
Haiku usage (from 2x to 6.5x compared to Opus).

At current rates, I would expect about 300M Sonnet tokens, 75M Haiku tokens, and 12M Opus tokens
before hitting the weekly limit. I'll see what actually happens once I hit the limit.

The model-tiering strategy from yesterday is already showing results.

---

## Other Discoveries

### Discovery 1: Mojo Formatter Has Edge Cases

I filed a bug against Mojo for their formatter not handling a weird corner case correctly. The formatter
works for most code, but fails on a specific pattern that shouldn't break it.

The issue is here: [Mojo issue #5573](https://github.com/modular/modular/issues/5573)

This makes the formatting check useless for now. I've gone ahead and removed the pre-commit hook for
Mojo formatting until it gets fixed. Once Mojo fixes it, I'll re-enable it.

### Discovery 2: Optimization Is Showing Real Effects

The jump from Haiku 2x Opus to 6.5x Opus isn't random. It's a direct result of:

1. Yesterday's model-tier assignments (Haiku for simpler tasks)
2. Better agent specialization reducing token waste
3. Cleaner documentation reducing re-planning cycles

This is the kind of data-driven feedback loop that makes systems better.

### Discovery 3: Weekly Budget Forces Discipline

30% budget consumed in one day is still aggressive, but the *ratio* has improved. The system is doing
more work per token than it was earlier.

This constraint is actually a feature. It forces me to think about efficiency early instead of patching
it in later.

---

## What's Next

Immediate priorities:

1. **Monitor token consumption** - Track whether the Haiku ratio continues improving or plateaus
2. **Implement event-driven agent triggering** - Further reduce overhead from prompt-based coordination
3. **Build per-agent token tracking** - Identify which agents are still burning excess tokens
4. **Begin Mojo implementation** - Foundation is stable enough to start core ML work
5. **Wait for Mojo formatter fix** - Then re-enable pre-commit hook for formatting checks

---

## Reflections

This day taught me something important about measuring progress:

1. **Data tells the story** - Raw token counts showed exactly what's working and what isn't. The Haiku
   ratio jump is the real metric, not the absolute cost.
2. **Constraints breed innovation** - Token budgets force better architecture. I'm being more thoughtful
   about model selection than I would be with unlimited budget.
3. **Optimization happens incrementally** - Each day's small changes (model tiering, agent
   specialization) compound into measurable improvements.
4. **Documentation is the foundation** - The ability to optimize depends on having clear specifications
   and clean infrastructure. That's why I spent time on docs instead of racing into code.

The agents are alive. The workflow is efficient. Time to use this foundation to build something.

---

**Status:** Agent system running efficiently with optimized model-tiering, token tracking underway,
foundation ready for Mojo implementation

**Next:** Monitor token consumption patterns, implement event-driven coordination, begin LeNet-5
implementation

**Stats:**

- 2 sessions actively consuming budget
- Haiku usage increased 3.25x (from 2x to 6.5x relative to Opus)
- Weekly budget 30% consumed in 1 day (improved from unsustainable levels)
- 1 Mojo formatter bug filed and documented
- 430M+ tokens consumed since agent system activated
- 1 developer cautiously optimistic about model-tiering results
