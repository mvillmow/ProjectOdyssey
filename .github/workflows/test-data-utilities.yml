name: Test Data Utilities

on:
  push:
    branches: [main]
    paths:
      - 'tests/shared/data/**'
      - 'shared/data/**'
      - '.github/workflows/test-data-utilities.yml'
  pull_request:
    branches: [main]
    paths:
      - 'tests/shared/data/**'
      - 'shared/data/**'
      - '.github/workflows/test-data-utilities.yml'

jobs:
  test-data-utilities:
    name: Data Utilities Test Suite
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v5

      - name: Set up Pixi
        uses: prefix-dev/setup-pixi@v0.9.3
        with:
          pixi-version: latest
          cache: true

      - name: Verify Mojo installation
        run: |
          pixi run mojo --version

      - name: Run Dataset Tests
        run: |
          echo "Running base dataset tests..."
          pixi run mojo tests/shared/data/datasets/test_base_dataset.mojo

          echo "Running tensor dataset tests..."
          pixi run mojo tests/shared/data/datasets/test_tensor_dataset.mojo

      - name: Run Loader Tests
        run: |
          echo "Running base loader tests..."
          pixi run mojo tests/shared/data/loaders/test_base_loader.mojo

      - name: Run Transform Tests
        run: |
          echo "Running transform pipeline tests..."
          pixi run mojo tests/shared/data/transforms/test_pipeline.mojo

      - name: Run Sampler Tests
        run: |
          echo "Running sequential sampler tests..."
          pixi run mojo tests/shared/data/samplers/test_sequential.mojo

      - name: Run All Data Tests
        run: |
          echo "Running complete data utilities test suite..."
          pixi run mojo tests/shared/data/run_all_tests.mojo

      - name: Report Results
        if: always()
        run: |
          echo "Data utilities test suite completed"
          echo "Check individual test outputs above for details"
